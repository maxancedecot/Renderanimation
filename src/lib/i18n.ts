export type Lang = 'fr' | 'en' | 'nl';

const M: Record<Lang, Record<string, string>> = {
  fr: {
    pricingTitle: 'Tarifs (abonnement)',
    pricingSubtitle: 'Nombre de vid√©os incluses par mois.',
    subscribe: "S‚Äôabonner",
    videosPerMonth: '{count} vid√©os / mois',
    discount10: '10% moins cher',
    discount20: '20% moins cher',
    language: 'Langue',
    howItWorks: 'Comment √ßa marche',
    navPricing: 'Tarifs',
    navApp: 'App',
    navLibrary: 'Biblioth√®que',
    navAccount: 'Espace',
    navSignin: 'Connexion',
    heroTitle: 'Anime tes rendus 3D en 3 clics',
    heroSub: "Upload ‚Üí Analyse de l‚Äôimage ‚Üí G√©n√©ration de vid√©o. Parfait pour les promoteurs immobiliers et studios d‚Äôarchi qui veulent animer des rendus statiques sans budget vid√©o exorbitant.",
    ctaSignIn: 'Se connecter',
    ctaSeePricing: 'Voir les tarifs',
    stepsTitle1: 'Upload',
    stepsDesc1: 'Importez votre rendu (JPG/PNG).',
    stepsTitle2: 'Analyse',
    stepsDesc2: 'L‚Äôimage est analys√©e pour en extraire un prompt adapt√©.',
    stepsTitle3: 'G√©n√©ration',
    stepsDesc3: 'Cr√©ation automatique de la vid√©o √† partir du rendu.',
    reviewsTitle: 'Avis clients',
    footer: 'Propuls√© par Maxance Decot üöÄ',
    // App/Upload
    uploadHeader: 'Uploader un rendu 3D',
    formatsHint: 'Formats JPG/PNG',
    uploadDropHint: 'Glisse ton image ou clique pour parcourir',
    uploadButton: 'Uploader',
    uploading: 'Upload‚Ä¶',
    reset: 'R√©initialiser',
    preparation: 'Pr√©paration',
    removePeople: 'Retirer les personnes',
    removingPeople: 'Retrait des personnes‚Ä¶',
    analyzeImage: 'Analyser l‚Äôimage',
    analyzing: 'Analyse‚Ä¶',
    generateHint: 'Clique sur G√©n√©rer la vid√©o pour lancer l‚Äôanimation.',
    generateStarting: 'D√©marrage‚Ä¶',
    generateInProgress: 'En cours‚Ä¶',
    generateAction: 'G√©n√©rer la vid√©o',
    preview: 'Aper√ßu',
    noImageYet: 'Aucune image pour le moment.',
    videoGenerated: 'Vid√©o g√©n√©r√©e',
    videoPending: 'La vid√©o appara√Ætra ici une fois pr√™te.',
    download: 'T√©l√©charger',
    viewLibrary: 'Voir la biblioth√®que',
    upscale4k: 'Upscale 4K',
    fourkPending: '4K en cours‚Ä¶',
    ra4kInProgress: 'RA 4K: en cours ‚Äî Cela peut prendre jusqu‚Äô√† 5 minutes.',
    ra4kSending: 'RA 4K: envoi‚Ä¶',
    version4k: 'Version 4K',
    confirmRemoveTitle: 'Retirer les personnes ?',
    confirmRemoveBody: 'Cette op√©ration peut modifier le ratio de l‚Äôimage nettoy√©e. Veux-tu continuer ?',
    cancel: 'Annuler',
    continue: 'Continuer',
    // Toasts
    toastUploading: 'Upload en cours‚Ä¶',
    toastUploaded: 'Image upload√©e ‚úÖ',
    toastUploadError: 'Erreur d‚Äôupload',
    toastRemoving: 'Suppression des personnes‚Ä¶',
    toastRemoved: 'Personnes retir√©es ‚úÖ',
    toastRemoveError: 'Erreur suppression',
    toastAnalyzing: 'Analyse en cours‚Ä¶',
    toastAnalyzed: 'Analyse OK ‚úÖ',
    toastAnalyzeError: 'Erreur analyse',
    toastTaskSubmitted: 'T√¢che soumise‚Ä¶',
    toastTaskReceived: 'T√¢che re√ßue',
    toastGenFailed: 'La g√©n√©ration a √©chou√©',
    toastVideoReady: 'Vid√©o pr√™te ‚ú®',
    toastSaved: 'Enregistr√© ‚úÖ',
    toastError: 'Erreur',
    toast4kStart: 'Upscale RA 4K lanc√©‚Ä¶',
    toast4kReceived: 'RA 4K: t√¢che re√ßue',
    toast4kError: 'Erreur RA 4K',
    toast4kFailed: 'Upscale RA 4K √©chou√©',
    toast4kReady: 'Version 4K pr√™te ‚ú®',
    // Library
    loading: 'Chargement‚Ä¶',
    errorPrefix: 'Erreur:',
    emptyLibrary: 'Aucune vid√©o enregistr√©e pour le moment.',
    folderLabel: 'Dossier:',
    all: 'Tous',
    deleteFolder: 'Supprimer le dossier',
    newFolderPlaceholder: 'Nouveau dossier',
    create: 'Cr√©er',
    noFolder: 'Sans dossier',
    projectLabel: 'Projet:',
    confirmDeleteTitle: 'Confirmer la suppression',
    confirmDeleteBody: '√ätes-vous s√ªr de vouloir supprimer la vid√©o ? Cette action est irr√©versible.',
    yes: 'Oui',
    no: 'Non',
    deleteFolderTitle: 'Supprimer ce dossier ?',
    deleteFolderBody: 'Les vid√©os du dossier ne seront pas supprim√©es et resteront sans dossier.',
    deleteTooltip: 'Supprimer',
    duplicateFolderName: 'Un dossier avec ce nom existe d√©j√†',
  },
  en: {
    pricingTitle: 'Pricing (subscription)',
    pricingSubtitle: 'Number of videos included per month.',
    subscribe: 'Subscribe',
    videosPerMonth: '{count} videos / month',
    discount10: '10% cheaper',
    discount20: '20% cheaper',
    language: 'Language',
    howItWorks: 'How it works',
    navPricing: 'Pricing',
    navApp: 'App',
    navLibrary: 'Library',
    navAccount: 'Account',
    navSignin: 'Sign in',
    heroTitle: 'Animate your 3D renders in 3 clicks',
    heroSub: 'Upload ‚Üí Analyze ‚Üí Generate video. Perfect for real-estate marketers and arch studios who want motion without a big video budget.',
    ctaSignIn: 'Sign in',
    ctaSeePricing: 'See pricing',
    stepsTitle1: 'Upload',
    stepsDesc1: 'Import your render (JPG/PNG).',
    stepsTitle2: 'Analyze',
    stepsDesc2: 'We analyze the image to craft a suitable prompt.',
    stepsTitle3: 'Generate',
    stepsDesc3: 'Automatically create the video from your still.',
    reviewsTitle: 'Customer reviews',
    footer: 'Powered by Maxance Decot üöÄ',
    // App/Upload
    uploadHeader: 'Upload a 3D render',
    formatsHint: 'JPG/PNG formats',
    uploadDropHint: 'Drag your image or click to browse',
    uploadButton: 'Upload',
    uploading: 'Uploading‚Ä¶',
    reset: 'Reset',
    preparation: 'Preparation',
    removePeople: 'Remove people',
    removingPeople: 'Removing people‚Ä¶',
    analyzeImage: 'Analyze image',
    analyzing: 'Analyzing‚Ä¶',
    generateHint: 'Click Generate video to start the animation.',
    generateStarting: 'Starting‚Ä¶',
    generateInProgress: 'In progress‚Ä¶',
    generateAction: 'Generate video',
    preview: 'Preview',
    noImageYet: 'No image yet.',
    videoGenerated: 'Generated video',
    videoPending: 'The video will appear here when ready.',
    download: 'Download',
    viewLibrary: 'View library',
    upscale4k: 'Upscale 4K',
    fourkPending: '4K in progress‚Ä¶',
    ra4kInProgress: 'RA 4K: in progress ‚Äî This can take up to 5 minutes.',
    ra4kSending: 'RA 4K: sending‚Ä¶',
    version4k: '4K version',
    confirmRemoveTitle: 'Remove people?',
    confirmRemoveBody: 'This may change the cleaned image‚Äôs aspect ratio. Continue?',
    cancel: 'Cancel',
    continue: 'Continue',
    // Toasts
    toastUploading: 'Uploading‚Ä¶',
    toastUploaded: 'Image uploaded ‚úÖ',
    toastUploadError: 'Upload error',
    toastRemoving: 'Removing people‚Ä¶',
    toastRemoved: 'People removed ‚úÖ',
    toastRemoveError: 'Remove error',
    toastAnalyzing: 'Analyzing‚Ä¶',
    toastAnalyzed: 'Analysis OK ‚úÖ',
    toastAnalyzeError: 'Analysis error',
    toastTaskSubmitted: 'Task submitted‚Ä¶',
    toastTaskReceived: 'Task received',
    toastGenFailed: 'Generation failed',
    toastVideoReady: 'Video ready ‚ú®',
    toastSaved: 'Saved ‚úÖ',
    toastError: 'Error',
    toast4kStart: 'RA 4K upscale started‚Ä¶',
    toast4kReceived: 'RA 4K: task received',
    toast4kError: 'RA 4K error',
    toast4kFailed: 'RA 4K upscale failed',
    toast4kReady: '4K version ready ‚ú®',
    // Library
    loading: 'Loading‚Ä¶',
    errorPrefix: 'Error:',
    emptyLibrary: 'No saved videos yet.',
    folderLabel: 'Folder:',
    all: 'All',
    deleteFolder: 'Delete folder',
    newFolderPlaceholder: 'New folder',
    create: 'Create',
    noFolder: 'No folder',
    projectLabel: 'Project:',
    confirmDeleteTitle: 'Confirm deletion',
    confirmDeleteBody: 'Are you sure you want to delete this video? This cannot be undone.',
    yes: 'Yes',
    no: 'No',
    deleteFolderTitle: 'Delete this folder?',
    deleteFolderBody: 'Videos in the folder will not be deleted and will remain without a folder.',
    deleteTooltip: 'Delete',
    duplicateFolderName: 'A folder with this name already exists',
  },
  nl: {
    pricingTitle: 'Prijzen (abonnement)',
    pricingSubtitle: 'Aantal video‚Äôs per maand inbegrepen.',
    subscribe: 'Abonneren',
    videosPerMonth: "{count} video's / maand",
    discount10: '10% goedkoper',
    discount20: '20% goedkoper',
    language: 'Taal',
    howItWorks: 'Hoe het werkt',
    navPricing: 'Prijzen',
    navApp: 'App',
    navLibrary: 'Bibliotheek',
    navAccount: 'Account',
    navSignin: 'Inloggen',
    heroTitle: 'Animeer je 3D-renders in 3 klikken',
    heroSub: 'Upload ‚Üí Analyse ‚Üí Video genereren. Ideaal voor vastgoedmarketeers en bureaus die beweging willen zonder groot videobudget.',
    ctaSignIn: 'Inloggen',
    ctaSeePricing: 'Prijzen bekijken',
    stepsTitle1: 'Upload',
    stepsDesc1: 'Upload je render (JPG/PNG).',
    stepsTitle2: 'Analyse',
    stepsDesc2: 'We analyseren de afbeelding en maken een passend prompt.',
    stepsTitle3: 'Genereren',
    stepsDesc3: 'Maak automatisch de video van je stilstaande beeld.',
    reviewsTitle: 'Klantreviews',
    footer: 'Aangedreven door Maxance Decot üöÄ',
    // App/Upload
    uploadHeader: 'Een 3D-render uploaden',
    formatsHint: 'JPG/PNG-formaten',
    uploadDropHint: 'Sleep je afbeelding of klik om te kiezen',
    uploadButton: 'Uploaden',
    uploading: 'Uploaden‚Ä¶',
    reset: 'Resetten',
    preparation: 'Voorbereiding',
    removePeople: 'Personen verwijderen',
    removingPeople: 'Personen verwijderen‚Ä¶',
    analyzeImage: 'Afbeelding analyseren',
    analyzing: 'Analyseren‚Ä¶',
    generateHint: 'Klik op Video genereren om te starten.',
    generateStarting: 'Starten‚Ä¶',
    generateInProgress: 'Bezig‚Ä¶',
    generateAction: 'Video genereren',
    preview: 'Voorbeeld',
    noImageYet: 'Nog geen afbeelding.',
    videoGenerated: 'Gegenereerde video',
    videoPending: 'De video verschijnt hier zodra die klaar is.',
    download: 'Downloaden',
    viewLibrary: 'Bibliotheek bekijken',
    upscale4k: '4K-upscale',
    fourkPending: '4K bezig‚Ä¶',
    ra4kInProgress: 'RA 4K: bezig ‚Äî Dit kan tot 5 minuten duren.',
    ra4kSending: 'RA 4K: verzenden‚Ä¶',
    version4k: '4K-versie',
    confirmRemoveTitle: 'Personen verwijderen?',
    confirmRemoveBody: 'Deze bewerking kan de beeldverhouding wijzigen. Doorgaan?',
    cancel: 'Annuleren',
    continue: 'Doorgaan',
    // Toasts
    toastUploading: 'Uploaden‚Ä¶',
    toastUploaded: 'Afbeelding ge√ºpload ‚úÖ',
    toastUploadError: 'Uploadfout',
    toastRemoving: 'Personen verwijderen‚Ä¶',
    toastRemoved: 'Personen verwijderd ‚úÖ',
    toastRemoveError: 'Verwijderfout',
    toastAnalyzing: 'Analyseren‚Ä¶',
    toastAnalyzed: 'Analyse OK ‚úÖ',
    toastAnalyzeError: 'Analysefout',
    toastTaskSubmitted: 'Taak ingediend‚Ä¶',
    toastTaskReceived: 'Taak ontvangen',
    toastGenFailed: 'Generatie mislukt',
    toastVideoReady: 'Video klaar ‚ú®',
    toastSaved: 'Opgeslagen ‚úÖ',
    toastError: 'Fout',
    toast4kStart: 'RA 4K-upsampling gestart‚Ä¶',
    toast4kReceived: 'RA 4K: taak ontvangen',
    toast4kError: 'RA 4K-fout',
    toast4kFailed: 'RA 4K-upsampling mislukt',
    toast4kReady: '4K-versie klaar ‚ú®',
    // Library
    loading: 'Laden‚Ä¶',
    errorPrefix: 'Fout:',
    emptyLibrary: 'Nog geen opgeslagen video‚Äôs.',
    folderLabel: 'Map:',
    all: 'Alle',
    deleteFolder: 'Map verwijderen',
    newFolderPlaceholder: 'Nieuwe map',
    create: 'Maken',
    noFolder: 'Geen map',
    projectLabel: 'Project:',
    confirmDeleteTitle: 'Verwijderen bevestigen',
    confirmDeleteBody: 'Weet je zeker dat je de video wilt verwijderen? Dit kan niet ongedaan worden gemaakt.',
    yes: 'Ja',
    no: 'Nee',
    deleteFolderTitle: 'Deze map verwijderen?',
    deleteFolderBody: 'Video‚Äôs worden niet verwijderd en blijven zonder map.',
    deleteTooltip: 'Verwijderen',
    duplicateFolderName: 'Er bestaat al een map met deze naam',
  },
};

export function t(lang: Lang, key: string, vars: Record<string, string | number> = {}): string {
  const base = M[lang]?.[key] ?? M.fr[key] ?? key;
  return Object.keys(vars).reduce((s, k) => s.replace(new RegExp(`\\{${k}\\}`, 'g'), String(vars[k])), base);
}

export function normalizeLang(input: unknown): Lang {
  const v = String(input || '').toLowerCase();
  if (v.startsWith('en')) return 'en';
  if (v.startsWith('nl')) return 'nl';
  return 'fr';
}

export function getClientLang(): Lang {
  try {
    const cookie = document.cookie.split('; ').find(c => c.startsWith('lang='));
    if (cookie) return normalizeLang(cookie.split('=')[1]);
  } catch {}
  try {
    const nav = (navigator?.language || '').toLowerCase();
    return normalizeLang(nav);
  } catch {}
  return 'fr';
}
