export type Lang = 'fr' | 'en' | 'nl';

const M: Record<Lang, Record<string, string>> = {
  fr: {
    pricingTitle: 'Tarifs (abonnement)',
    pricingSubtitle: 'Nombre de vidéos incluses par mois.',
    pricingMonthly: 'Mensuel',
    pricingYearly: 'Annuel',
    billedYearly: 'Facturé annuellement',
    includes4k: 'Upscale 4K inclus',
    subscribe: "S’abonner",
    videosPerMonth: '{count} vidéos / mois',
    discount10: '10% moins cher',
    discount20: '20% moins cher',
    language: 'Langue',
    howItWorks: 'Comment ça marche',
    navPricing: 'Tarifs',
    navApp: 'App',
    navLibrary: 'Bibliothèque',
    navAccount: 'Espace',
    navSignin: 'Connexion',
    heroTitle: 'Anime tes rendus 3D en 3 clics',
    heroSub: "Upload → Analyse de l’image → Génération de vidéo. Parfait pour les promoteurs immobiliers et studios d’archi qui veulent animer des rendus statiques sans budget vidéo exorbitant.",
    ctaSignIn: 'Se connecter',
    ctaSeePricing: 'Voir les tarifs',
    stepsTitle1: 'Upload',
    stepsDesc1: 'Importez votre rendu (JPG/PNG).',
    stepsTitle2: 'Analyse',
    stepsDesc2: 'L’image est analysée pour en extraire un prompt adapté.',
    stepsTitle3: 'Génération',
    stepsDesc3: 'Création automatique de la vidéo à partir du rendu.',
    reviewsTitle: 'Avis clients',
    footer: 'Propulsé par RenderAnimation.app',
    // App/Upload
    uploadHeader: 'Uploader un rendu 3D',
    formatsHint: 'Formats JPG/PNG',
    uploadDropHint: 'Glisse ton image ou clique pour parcourir',
    uploadButton: 'Uploader',
    uploading: 'Upload…',
    reset: 'Réinitialiser',
    preparation: 'Préparation',
    removePeople: 'Retirer les personnes',
    removingPeople: 'Retrait des personnes…',
    analyzeImage: 'Analyser l’image',
    analyzing: 'Analyse…',
    generateHint: 'Clique sur Générer la vidéo pour lancer l’animation.',
    generateStarting: 'Démarrage…',
    generateInProgress: 'En cours…',
    generateAction: 'Générer la vidéo',
    preview: 'Aperçu',
    noImageYet: 'Aucune image pour le moment.',
    videoGenerated: 'Vidéo générée',
    videoPending: 'La vidéo apparaîtra ici une fois prête.',
    download: 'Télécharger',
    viewLibrary: 'Voir la bibliothèque',
    upscale4k: 'Upscale 4K',
    fourkPending: '4K en cours…',
    ra4kInProgress: 'RA 4K: en cours — Cela peut prendre jusqu’à 5 minutes.',
    ra4kSending: 'RA 4K: envoi…',
    version4k: 'Version 4K',
    confirmRemoveTitle: 'Retirer les personnes ?',
    confirmRemoveBody: 'Cette opération peut modifier le ratio de l’image nettoyée. Veux-tu continuer ?',
    cancel: 'Annuler',
    continue: 'Continuer',
    // Toasts
    toastUploading: 'Upload en cours…',
    toastUploaded: 'Image uploadée ✅',
    toastUploadError: 'Erreur d’upload',
    toastRemoving: 'Suppression des personnes…',
    toastRemoved: 'Personnes retirées ✅',
    toastRemoveError: 'Erreur suppression',
    toastAnalyzing: 'Analyse en cours…',
    toastAnalyzed: 'Analyse OK ✅',
    toastAnalyzeError: 'Erreur analyse',
    toastTaskSubmitted: 'Tâche soumise…',
    toastTaskReceived: 'Tâche reçue',
    toastGenFailed: 'La génération a échoué',
    toastVideoReady: 'Vidéo prête ✨',
    toastSaved: 'Enregistré ✅',
    toastError: 'Erreur',
    toast4kStart: 'Upscale RA 4K lancé…',
    toast4kReceived: 'RA 4K: tâche reçue',
    toast4kError: 'Erreur RA 4K',
    toast4kFailed: 'Upscale RA 4K échoué',
    toast4kReady: 'Version 4K prête ✨',
    // Library
    loading: 'Chargement…',
    errorPrefix: 'Erreur:',
    emptyLibrary: 'Aucune vidéo enregistrée pour le moment.',
    folderLabel: 'Dossier:',
    all: 'Tous',
    deleteFolder: 'Supprimer le dossier',
    newFolderPlaceholder: 'Nouveau dossier',
    create: 'Créer',
    noFolder: 'Sans dossier',
    projectLabel: 'Projet:',
    confirmDeleteTitle: 'Confirmer la suppression',
    confirmDeleteBody: 'Êtes-vous sûr de vouloir supprimer la vidéo ? Cette action est irréversible.',
    yes: 'Oui',
    no: 'Non',
    deleteFolderTitle: 'Supprimer ce dossier ?',
    deleteFolderBody: 'Les vidéos du dossier ne seront pas supprimées et resteront sans dossier.',
    deleteTooltip: 'Supprimer',
    duplicateFolderName: 'Un dossier avec ce nom existe déjà',
  },
  en: {
    pricingTitle: 'Pricing (subscription)',
    pricingSubtitle: 'Number of videos included per month.',
    pricingMonthly: 'Monthly',
    pricingYearly: 'Yearly',
    billedYearly: 'Billed yearly',
    includes4k: '4K upscale included',
    subscribe: 'Subscribe',
    videosPerMonth: '{count} videos / month',
    discount10: '10% cheaper',
    discount20: '20% cheaper',
    language: 'Language',
    howItWorks: 'How it works',
    navPricing: 'Pricing',
    navApp: 'App',
    navLibrary: 'Library',
    navAccount: 'Account',
    navSignin: 'Sign in',
    heroTitle: 'Animate your 3D renders in 3 clicks',
    heroSub: 'Upload → Analyze → Generate video. Perfect for real-estate marketers and arch studios who want motion without a big video budget.',
    ctaSignIn: 'Sign in',
    ctaSeePricing: 'See pricing',
    stepsTitle1: 'Upload',
    stepsDesc1: 'Import your render (JPG/PNG).',
    stepsTitle2: 'Analyze',
    stepsDesc2: 'We analyze the image to craft a suitable prompt.',
    stepsTitle3: 'Generate',
    stepsDesc3: 'Automatically create the video from your still.',
    reviewsTitle: 'Customer reviews',
    footer: 'Powered by RenderAnimation.app',
    // App/Upload
    uploadHeader: 'Upload a 3D render',
    formatsHint: 'JPG/PNG formats',
    uploadDropHint: 'Drag your image or click to browse',
    uploadButton: 'Upload',
    uploading: 'Uploading…',
    reset: 'Reset',
    preparation: 'Preparation',
    removePeople: 'Remove people',
    removingPeople: 'Removing people…',
    analyzeImage: 'Analyze image',
    analyzing: 'Analyzing…',
    generateHint: 'Click Generate video to start the animation.',
    generateStarting: 'Starting…',
    generateInProgress: 'In progress…',
    generateAction: 'Generate video',
    preview: 'Preview',
    noImageYet: 'No image yet.',
    videoGenerated: 'Generated video',
    videoPending: 'The video will appear here when ready.',
    download: 'Download',
    viewLibrary: 'View library',
    upscale4k: 'Upscale 4K',
    fourkPending: '4K in progress…',
    ra4kInProgress: 'RA 4K: in progress — This can take up to 5 minutes.',
    ra4kSending: 'RA 4K: sending…',
    version4k: '4K version',
    confirmRemoveTitle: 'Remove people?',
    confirmRemoveBody: 'This may change the cleaned image’s aspect ratio. Continue?',
    cancel: 'Cancel',
    continue: 'Continue',
    // Toasts
    toastUploading: 'Uploading…',
    toastUploaded: 'Image uploaded ✅',
    toastUploadError: 'Upload error',
    toastRemoving: 'Removing people…',
    toastRemoved: 'People removed ✅',
    toastRemoveError: 'Remove error',
    toastAnalyzing: 'Analyzing…',
    toastAnalyzed: 'Analysis OK ✅',
    toastAnalyzeError: 'Analysis error',
    toastTaskSubmitted: 'Task submitted…',
    toastTaskReceived: 'Task received',
    toastGenFailed: 'Generation failed',
    toastVideoReady: 'Video ready ✨',
    toastSaved: 'Saved ✅',
    toastError: 'Error',
    toast4kStart: 'RA 4K upscale started…',
    toast4kReceived: 'RA 4K: task received',
    toast4kError: 'RA 4K error',
    toast4kFailed: 'RA 4K upscale failed',
    toast4kReady: '4K version ready ✨',
    // Library
    loading: 'Loading…',
    errorPrefix: 'Error:',
    emptyLibrary: 'No saved videos yet.',
    folderLabel: 'Folder:',
    all: 'All',
    deleteFolder: 'Delete folder',
    newFolderPlaceholder: 'New folder',
    create: 'Create',
    noFolder: 'No folder',
    projectLabel: 'Project:',
    confirmDeleteTitle: 'Confirm deletion',
    confirmDeleteBody: 'Are you sure you want to delete this video? This cannot be undone.',
    yes: 'Yes',
    no: 'No',
    deleteFolderTitle: 'Delete this folder?',
    deleteFolderBody: 'Videos in the folder will not be deleted and will remain without a folder.',
    deleteTooltip: 'Delete',
    duplicateFolderName: 'A folder with this name already exists',
  },
  nl: {
    pricingTitle: 'Prijzen (abonnement)',
    pricingSubtitle: 'Aantal video’s per maand inbegrepen.',
    pricingMonthly: 'Maandelijks',
    pricingYearly: 'Jaarlijks',
    billedYearly: 'Jaarlijks gefactureerd',
    includes4k: '4K-upscale inbegrepen',
    subscribe: 'Abonneren',
    videosPerMonth: "{count} video's / maand",
    discount10: '10% goedkoper',
    discount20: '20% goedkoper',
    language: 'Taal',
    howItWorks: 'Hoe het werkt',
    navPricing: 'Prijzen',
    navApp: 'App',
    navLibrary: 'Bibliotheek',
    navAccount: 'Account',
    navSignin: 'Inloggen',
    heroTitle: 'Animeer je 3D-renders in 3 klikken',
    heroSub: 'Upload → Analyse → Video genereren. Ideaal voor vastgoedmarketeers en bureaus die beweging willen zonder groot videobudget.',
    ctaSignIn: 'Inloggen',
    ctaSeePricing: 'Prijzen bekijken',
    stepsTitle1: 'Upload',
    stepsDesc1: 'Upload je render (JPG/PNG).',
    stepsTitle2: 'Analyse',
    stepsDesc2: 'We analyseren de afbeelding en maken een passend prompt.',
    stepsTitle3: 'Genereren',
    stepsDesc3: 'Maak automatisch de video van je stilstaande beeld.',
    reviewsTitle: 'Klantreviews',
    footer: 'Aangedreven door RenderAnimation.app',
    // App/Upload
    uploadHeader: 'Een 3D-render uploaden',
    formatsHint: 'JPG/PNG-formaten',
    uploadDropHint: 'Sleep je afbeelding of klik om te kiezen',
    uploadButton: 'Uploaden',
    uploading: 'Uploaden…',
    reset: 'Resetten',
    preparation: 'Voorbereiding',
    removePeople: 'Personen verwijderen',
    removingPeople: 'Personen verwijderen…',
    analyzeImage: 'Afbeelding analyseren',
    analyzing: 'Analyseren…',
    generateHint: 'Klik op Video genereren om te starten.',
    generateStarting: 'Starten…',
    generateInProgress: 'Bezig…',
    generateAction: 'Video genereren',
    preview: 'Voorbeeld',
    noImageYet: 'Nog geen afbeelding.',
    videoGenerated: 'Gegenereerde video',
    videoPending: 'De video verschijnt hier zodra die klaar is.',
    download: 'Downloaden',
    viewLibrary: 'Bibliotheek bekijken',
    upscale4k: '4K-upscale',
    fourkPending: '4K bezig…',
    ra4kInProgress: 'RA 4K: bezig — Dit kan tot 5 minuten duren.',
    ra4kSending: 'RA 4K: verzenden…',
    version4k: '4K-versie',
    confirmRemoveTitle: 'Personen verwijderen?',
    confirmRemoveBody: 'Deze bewerking kan de beeldverhouding wijzigen. Doorgaan?',
    cancel: 'Annuleren',
    continue: 'Doorgaan',
    // Toasts
    toastUploading: 'Uploaden…',
    toastUploaded: 'Afbeelding geüpload ✅',
    toastUploadError: 'Uploadfout',
    toastRemoving: 'Personen verwijderen…',
    toastRemoved: 'Personen verwijderd ✅',
    toastRemoveError: 'Verwijderfout',
    toastAnalyzing: 'Analyseren…',
    toastAnalyzed: 'Analyse OK ✅',
    toastAnalyzeError: 'Analysefout',
    toastTaskSubmitted: 'Taak ingediend…',
    toastTaskReceived: 'Taak ontvangen',
    toastGenFailed: 'Generatie mislukt',
    toastVideoReady: 'Video klaar ✨',
    toastSaved: 'Opgeslagen ✅',
    toastError: 'Fout',
    toast4kStart: 'RA 4K-upsampling gestart…',
    toast4kReceived: 'RA 4K: taak ontvangen',
    toast4kError: 'RA 4K-fout',
    toast4kFailed: 'RA 4K-upsampling mislukt',
    toast4kReady: '4K-versie klaar ✨',
    // Library
    loading: 'Laden…',
    errorPrefix: 'Fout:',
    emptyLibrary: 'Nog geen opgeslagen video’s.',
    folderLabel: 'Map:',
    all: 'Alle',
    deleteFolder: 'Map verwijderen',
    newFolderPlaceholder: 'Nieuwe map',
    create: 'Maken',
    noFolder: 'Geen map',
    projectLabel: 'Project:',
    confirmDeleteTitle: 'Verwijderen bevestigen',
    confirmDeleteBody: 'Weet je zeker dat je de video wilt verwijderen? Dit kan niet ongedaan worden gemaakt.',
    yes: 'Ja',
    no: 'Nee',
    deleteFolderTitle: 'Deze map verwijderen?',
    deleteFolderBody: 'Video’s worden niet verwijderd en blijven zonder map.',
    deleteTooltip: 'Verwijderen',
    duplicateFolderName: 'Er bestaat al een map met deze naam',
  },
};

export function t(lang: Lang, key: string, vars: Record<string, string | number> = {}): string {
  const base = M[lang]?.[key] ?? M.fr[key] ?? key;
  return Object.keys(vars).reduce((s, k) => s.replace(new RegExp(`\\{${k}\\}`, 'g'), String(vars[k])), base);
}

export function normalizeLang(input: unknown): Lang {
  const v = String(input || '').toLowerCase();
  if (v.startsWith('en')) return 'en';
  if (v.startsWith('nl')) return 'nl';
  return 'fr';
}

export function getClientLang(): Lang {
  try {
    const cookie = document.cookie.split('; ').find(c => c.startsWith('lang='));
    if (cookie) return normalizeLang(cookie.split('=')[1]);
  } catch {}
  try {
    const nav = (navigator?.language || '').toLowerCase();
    return normalizeLang(nav);
  } catch {}
  return 'fr';
}
